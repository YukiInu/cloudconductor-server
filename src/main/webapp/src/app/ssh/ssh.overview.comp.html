<cc-title title="SSH Keys" [titleIcon]="'fa-key'"></cc-title>

<div class="row">
  <div class="col-md-3">
    <cc-filter (onQueryChange)="searchQuery = $event"></cc-filter>
  </div>
  <div class="col-md-3">
    <cc-filter mode="select" label="Template" [data]="templates" (onQueryChange)="searchTemplateQuery = $event"
      [dataField]="'name'">
    </cc-filter>
  </div>
  <div *ngIf="!showAddKey" class="col-md-6">
    <button class="btn btn-success pull-right" role="button" (click)="goToAddKey()">
      <i class="fa fa-plus fa-fw"></i>
      Add SSH Key
    </button>
  </div>
</div>

<div class="row" *ngIf="!keysLoaded">
  <div class="col-sm-12">
    <div class="alert alert-info">
      <i class="fa fa-spinner fa-pulse fa-fw"></i>
      Loading SSH keys...
    </div>
  </div>
</div>

<div class="row" *ngIf="keysLoaded && sshKeys.length < 1">
  <div class="col-sm-12">
    <div class="alert alert-warning">
        No SSH keys found
    </div>
  </div>
</div>

<div class="row" *ngIf="sshKeys.length > 0">
  <div [class.col-lg-6]="showAddKey" [class.col-lg-12]="!showAddKey" class="col-md-12">
    <cc-panel [icon]="'fa-key'" [title]="'All SSH Keys'">
      <table class="table table-responsive table-striped table-hover" cc-panel-body>
        <thead>
          <tr>
            <th>Owner</th>
            <th>User Name</th>
            <th>Templates</th>
            <th>Last Modified</th>
            <th width="15px"></th>
            <th width="15px"></th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let sshKey of sshKeys" (dblclick)="gotoDetails(sshKey)">
            <td>{{sshKey.owner}}</td>
            <td>{{sshKey.username}}</td>
            <td>
              <ul>
                <li *ngFor="let template of sshKey.templates">{{template}}</li>
              </ul>
            </td>
            <td>{{sshKey.lastChanged | date:'dd.MM.yyyy HH:mm'}}</td>
            <td>
              <a title="Edit SSH Key" [routerLink]="['/ssh', sshKey.owner]"><i class="fa fa-edit fa-fw"></i></a>
            </td>
            <td>
              <a href="javascript:void(0)" mwlConfirmationPopover
              title="Delete SSH Key"
              [title]="'Please verify!'"
              [message]="'Are you sure you want to delete the ssh key of ' + sshKey.owner + '?'"
              placement="left"
              confirmButtonType="danger"
              (confirm)="deleteKey(sshKey)">
                <i class="fa fa-trash-o fa-fw"></i>
              </a>
            </td>
          </tr>
        </tbody>
      </table>
    </cc-panel>
  </div>

  <div *ngIf="showAddKey" class="col-lg-6 col-md-12">
    <cc-panel [icon]="'fa-plus'" [title]="'New SSH Key'">
      <app-ssh-edit cc-panel-body [key]="newKey" [templateNames]="templateNames" [isCreate]="true" (onSave)="addKey($event)" (onCancel)="showAddKey = false">
      </app-ssh-edit>
    </cc-panel>
  </div>
</div>
